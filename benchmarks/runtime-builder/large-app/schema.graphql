schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}

type Query {
  # Products
  products(categoryId: ID, brandId: ID, priceRange: PriceRangeInput, limit: Int, offset: Int): ProductConnection!
  product(id: ID!): Product
  productsByIds(ids: [ID!]!): [Product!]!
  searchProducts(query: String!, limit: Int): [Product!]!

  # Categories
  categories(parentId: ID): [Category!]!
  category(id: ID!): Category

  # Orders
  orders(userId: ID!, status: OrderStatus, dateRange: DateRangeInput): OrderConnection!
  order(id: ID!): Order

  # Users
  user(id: ID!): User
  users(role: UserRole, limit: Int): [User!]!

  # Cart
  cart(userId: ID!): Cart

  # Reviews
  reviews(productId: ID, userId: ID, minRating: Int, limit: Int): [Review!]!

  # Brands
  brands(limit: Int): [Brand!]!
  brand(id: ID!): Brand

  # Analytics
  productAnalytics(productId: ID!): ProductAnalytics
  salesAnalytics(dateRange: DateRangeInput!): SalesAnalytics
}

type Product {
  id: ID!
  name: String!
  description: String
  price: Float!
  discountedPrice: Float
  sku: String!
  stockQuantity: Int!
  category: Category!
  brand: Brand!
  images: [ProductImage!]!
  attributes: [ProductAttribute!]!
  reviews(limit: Int, minRating: Int): [Review!]!
  averageRating: Float
  reviewCount: Int!
  relatedProducts(limit: Int): [Product!]!
  createdAt: String!
  updatedAt: String!
}

type ProductImage {
  id: ID!
  url: String!
  alt: String
  isPrimary: Boolean!
  order: Int!
}

type ProductAttribute {
  id: ID!
  name: String!
  value: String!
}

type Category {
  id: ID!
  name: String!
  slug: String!
  description: String
  parent: Category
  children: [Category!]!
  products(limit: Int): [Product!]!
  productCount: Int!
}

type Brand {
  id: ID!
  name: String!
  slug: String!
  description: String
  logo: String
  products(limit: Int): [Product!]!
}

type Order {
  id: ID!
  userId: ID!
  user: User!
  items: [OrderItem!]!
  status: OrderStatus!
  paymentStatus: PaymentStatus!
  shippingAddress: Address!
  billingAddress: Address!
  subtotal: Float!
  tax: Float!
  shippingCost: Float!
  discount: Float!
  totalAmount: Float!
  notes: String
  createdAt: String!
  updatedAt: String!
}

type OrderItem {
  id: ID!
  product: Product!
  quantity: Int!
  priceAtPurchase: Float!
  discountAtPurchase: Float!
  totalPrice: Float!
}

type User {
  id: ID!
  email: String!
  firstName: String!
  lastName: String!
  role: UserRole!
  avatar: String
  addresses: [Address!]!
  orders(limit: Int, status: OrderStatus): [Order!]!
  cart: Cart
  wishlist: [Product!]!
  reviews: [Review!]!
  createdAt: String!
  lastLoginAt: String
}

type Address {
  id: ID!
  type: AddressType!
  street: String!
  city: String!
  state: String!
  country: String!
  postalCode: String!
  isDefault: Boolean!
}

type Cart {
  id: ID!
  userId: ID!
  items: [CartItem!]!
  subtotal: Float!
  itemCount: Int!
  updatedAt: String!
}

type CartItem {
  id: ID!
  product: Product!
  quantity: Int!
  addedAt: String!
}

type Review {
  id: ID!
  product: Product!
  user: User!
  rating: Int!
  title: String
  comment: String
  helpful: Int!
  verified: Boolean!
  createdAt: String!
  updatedAt: String
}

type ProductAnalytics {
  productId: ID!
  viewCount: Int!
  purchaseCount: Int!
  addToCartCount: Int!
  averageRating: Float
  conversionRate: Float!
}

type SalesAnalytics {
  totalRevenue: Float!
  totalOrders: Int!
  averageOrderValue: Float!
  topProducts: [ProductSalesMetric!]!
  topCategories: [CategorySalesMetric!]!
}

type ProductSalesMetric {
  product: Product!
  revenue: Float!
  quantity: Int!
}

type CategorySalesMetric {
  category: Category!
  revenue: Float!
  orderCount: Int!
}

type ProductConnection {
  edges: [ProductEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type ProductEdge {
  node: Product!
  cursor: String!
}

type OrderConnection {
  edges: [OrderEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type OrderEdge {
  node: Order!
  cursor: String!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  PENDING
  AUTHORIZED
  CAPTURED
  FAILED
  REFUNDED
}

enum UserRole {
  CUSTOMER
  ADMIN
  VENDOR
}

enum AddressType {
  SHIPPING
  BILLING
  BOTH
}

input PriceRangeInput {
  min: Float
  max: Float
}

input DateRangeInput {
  start: String!
  end: String!
}

input CreateProductInput {
  name: String!
  description: String
  price: Float!
  sku: String!
  stockQuantity: Int!
  categoryId: ID!
  brandId: ID!
  images: [ProductImageInput!]
  attributes: [ProductAttributeInput!]
}

input ProductImageInput {
  url: String!
  alt: String
  isPrimary: Boolean!
  order: Int!
}

input ProductAttributeInput {
  name: String!
  value: String!
}

input UpdateProductInput {
  id: ID!
  name: String
  description: String
  price: Float
  discountedPrice: Float
  stockQuantity: Int
  categoryId: ID
  brandId: ID
  images: [ProductImageInput!]
  attributes: [ProductAttributeInput!]
}

input CreateOrderInput {
  userId: ID!
  items: [OrderItemInput!]!
  shippingAddressId: ID!
  billingAddressId: ID!
  notes: String
}

input OrderItemInput {
  productId: ID!
  quantity: Int!
}

input UpdateCartInput {
  userId: ID!
  productId: ID!
  quantity: Int!
}

input AddReviewInput {
  productId: ID!
  userId: ID!
  rating: Int!
  title: String
  comment: String
}

type Mutation {
  # Products
  createProduct(input: CreateProductInput!): Product!
  updateProduct(input: UpdateProductInput!): Product!
  deleteProduct(id: ID!): Boolean!

  # Orders
  createOrder(input: CreateOrderInput!): Order!
  updateOrderStatus(id: ID!, status: OrderStatus!): Order!
  updatePaymentStatus(id: ID!, status: PaymentStatus!): Order!
  cancelOrder(id: ID!): Order!

  # Cart
  addToCart(input: UpdateCartInput!): Cart!
  removeFromCart(userId: ID!, cartItemId: ID!): Cart!
  clearCart(userId: ID!): Cart!

  # Reviews
  addReview(input: AddReviewInput!): Review!
  updateReview(id: ID!, rating: Int, title: String, comment: String): Review!
  deleteReview(id: ID!): Boolean!
  markReviewHelpful(id: ID!): Review!

  # User
  updateUserProfile(id: ID!, firstName: String, lastName: String, avatar: String): User!
  addAddress(userId: ID!, address: AddressInput!): Address!
  updateAddress(id: ID!, address: AddressInput!): Address!
  deleteAddress(id: ID!): Boolean!
}

input AddressInput {
  type: AddressType!
  street: String!
  city: String!
  state: String!
  country: String!
  postalCode: String!
  isDefault: Boolean!
}

type Subscription {
  orderStatusChanged(userId: ID!): Order!
  cartUpdated(userId: ID!): Cart!
  productPriceChanged(productId: ID!): Product!
  newReview(productId: ID!): Review!
}
